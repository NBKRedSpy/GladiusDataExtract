@page
@using GladiusDataExtract.Units;
@using GladiusDataExtract.Weapons;
@model GladiusStatWeb.Pages.UnitsModel



@*@foreach (var unit in Model.Units)*@

@foreach (var unit in Model.Units.Where(x => x.Name == "Termagant"))
{
	<div class="unit-name">@unit.Name</div>
	<div>
		<div class="stats-container">
		<div>Count: @unit.ModelCount </div>

		@foreach (UnitAttribute unitAttribute in Model.GetDisplayAttributes(unit))
		{
			<span>@unitAttribute.Name @unitAttribute.Value</span>
		}
		</div>
		<div class="weapons-container">
			@foreach (Weapon weapon in unit.Weapons)
			{
				var stats = Model.GetWeaponStats(unit, weapon);	

				<span class="weapon-name" >@weapon.Name</span>

				{

					//Todo:  Have to handle the ranged and melee accuracy not showing up.
					//targetRange != 0 seems to mean ranged.
					//<meleeAccuracy base="6"/> <!-- %meleeAccuracy base weaponSkill=3 -->
					//<meleeAttacks base="1" />
					//
					//<rangedAccuracy base="6"/> <!-- %rangedAccuracy base ballisticSkill=3 -->


					bool isRanged = weapon.targetRange != 0;

					if(isRanged)
					{
						var accuracyAttribute = unit.Attributes.SingleOrDefault(x => x.Name == "rangedAccuracy");
						decimal accuracy = accuracyAttribute is null ? 0m : accuracyAttribute.Value;


						<div class="weapon-stats">Range: @weapon.targetRange</div>
						<div class="weapon-stats">Accuracy: @accuracy </div>
					}
					else
					{
						//Assume Melee
						var accuracyAttribute = unit.Attributes.SingleOrDefault(x => x.Name == "meleeAccuracy");
						decimal accuracy = accuracyAttribute is null ? 0m : accuracyAttribute.Value;
						<div class="weapon-stats">Accuracy: @accuracy </div>
					}
				}

				foreach (var stat in stats)
				{
					bool isAttacks = stat.Item1 == "attacks";
					
					<div class="weapon-stats">@stat.Item1: @stat.Item2 @if (isAttacks)
						{
							@(" (x" + unit.ModelCount + ")")
						}
					</div>

					@*<div class="weapon-stats">@stat.Item1: @stat.Item2</div>*@
				}
			}
		</div>
		
	</div>



}
