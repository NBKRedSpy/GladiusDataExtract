@page
@using GladiusDataExtract.Entities;
@model GladiusStatWeb.Pages.UnitsModel



@foreach (var unit in Model.Units)
{
	string htmlId = unit.Key.Replace("/", "-");

	<div class="unit-name" id="@htmlId"><a class="unit__name-link" href="#@htmlId">@unit.Name</a></div>
	<div class="unit__content">
		<div class="unit__item-content">
			<span>@{await DisplayIcon("PopulationLimit", "Model Count");} @unit.ModelCount </span>
			<span>@{await DisplayIcon("Armor");} @unit.Armor</span>
			<span>@{await DisplayIcon("HitPoints");} @unit.Hitpoints 
				@{
					if(unit.ModelCount > 1)
					{
						@("(" + (unit.ModelCount * unit.Hitpoints).ToString() + ")")
					}
				}
			</span>
			<span>@{await DisplayIcon("Movement");}@unit.Movement</span>

			@{await ShowResourceIfNotZero("BioMass", unit.ProductionResources.BioMass);}
			@{await ShowResourceIfNotZero("Energy", unit.ProductionResources.Energy);}
			@{await ShowResourceIfNotZero("Food", unit.ProductionResources.Food);}
			@{await ShowResourceIfNotZero("Influence", unit.ProductionResources.Influence);}
			@{await ShowResourceIfNotZero("Ore", unit.ProductionResources.Ore);}

		</div>

		<div class="unit__item-content">
			<div class="unit__header">Weapons</div>
			<div class="unit__item-content">
				@foreach (Weapon weapon in unit.Weapons)
				{
					<span class="unit__header" >@weapon.Name</span>

					<div class="unit__item-content-separate">
						<span>@{await DisplayIcon("Damage");} @weapon.Damage</span>
						<span>@{await DisplayIcon("Attacks");} @weapon.AttackCount</span>
						<span>@{await DisplayIcon("ArmorPenetration");} @weapon.ArmorPenetration</span>
						<span>@{await DisplayIcon("Accuracy");}@weapon.Accuracy</span>
						@if (weapon.RequiredUpgrade != "")
						{
							<div><span class="property-name">Unit Upgrade Requirement: </span>@weapon.RequiredUpgrade</div>
						}

						<div class="unit__header">Traits</div>
						<div class="unit__item-content">
						@foreach (var trait in weapon.Traits)
						{
							<div>@trait</div>
						}
						</div>
						@if (weapon.Requirements.Count > 0)
						{
							<div class="unit__header">Weapon Requirements</div>
							<div class="unit__item-content">

							@foreach(var requirement in weapon.Requirements)
								{
									<div><span>@requirement.Name</span>
										@if(requirement.RequiredUpgrade != requirement.Name){
											<span> -> @requirement.RequiredUpgrade</span> 
										}
									</div>
								}
							</div>
						}
					</div>
				}

				@if(unit.Traits.Count != 0)
				{
					<div class="unit__header">Traits</div>

					<div class="unit__item-content">

						@foreach (var trait in unit.Traits)
						{
							<div>@trait</div>	
						}
					</div>
				}

				@if (unit.Upgrades.Count != 0)
				{
					<div class="unit__header">Upgrades</div>

					<div class="unit__item-content">

						@foreach (var upgrade in unit.Upgrades)
						{
							<div>
								@upgrade.Name @(" -> " + upgrade.RequiredUpgrade)
							</div>
						}
					</div>
				}
			</div>

		</div>
	</div>


	async Task ShowResourceIfNotZero(string iconName, decimal value, string text = "")
	{
		if (value != 0)
		{
			<span>@{
					await DisplayIcon(iconName);
				} @value.ToString("#.##")</span>
		}
	}

	async Task DisplayIcon(string iconName, string text = "")
	{
		string displayText = text == "" ? iconName : text;

		<span class="icon-container">
			<img class="icon" data-bs-toggle="tooltip" data-bs-title="@displayText" src="~/img/@(iconName).png" 
				)"></img>
		</span>
	}
}

@section Scripts {
<script type="text/javascript">
	const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
	const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

</script>
}
